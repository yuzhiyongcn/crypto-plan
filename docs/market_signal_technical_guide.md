# 《牛熊转换信号技术指南》

本文档详细阐述了我们的自动化“牛熊转换战略雷达” (`market_signal_monitor.py`) 的技术原理、指标选择和决策逻辑，旨在为您提供清晰的调试和理解框架。

---

### **1. 核心设计哲学：多指标共振**

单一指标在复杂的市场中容易产生假信号。我们的系统建立在“多指标共振”的哲学之上：**只有当多个来自不同维度（趋势、链上、动量）的指标同时指向同一个方向时，我们才认为一个宏观的市场转向信号是高度可靠的。**

这是一种用“证据链”取代“单点证据”的专业决策模型。

---

### **2. 关于执行频率与最佳实践**

*   **信号质量 (为何推荐每周一次？)**：我们选用的所有指标（20周EMA、周线RSI、链上数据）都是用于捕捉**宏观趋势**的**长周期指标**。它们的意义在于周线收盘价确认之后。以日为单位进行检查，会引入大量市场“噪音”，导致频繁的假警报，与我们的长线战略目标背道而驰。

*   **最佳执行时间 (为何选择周一凌晨？)**：全球加密货币市场的周线K线在**UTC时间周一的00:00**（即周日午夜）正式收盘。为了确保我们获取到的是**完整的、已收盘的**上周数据，而不是仍在变动中的本周数据，最稳妥的做法是在此之后执行脚本。因此，脚本默认的执行时间被设定在服务器时间的**每周一凌晨2点**，以此消除时区差异带来的数据不确定性。

*   **如何修改**：尽管如此，如果您希望进行测试或调整，可以将 `market_signal_monitor.py` 脚本底部的调度代码从：
    ```python
    schedule.every().monday.at("02:00").do(check_market_signals)
    ```
    修改为（例如每日执行）：
    ```python
    schedule.every().day.at("02:00").do(check_market_signals)
    ```

---

### **3. “牛转熊”信号仪表盘 (Bull-to-Bear Dashboard)**

当以下**主条件**和**至少两个次要条件**同时满足时，触发“战略收缩”警报。

*   #### **主条件 (必须满足):**
    *   **20周EMA跌破**: 价格的**周线收盘价**，已**连续两周**低于其20周EMA。这确认了中期趋势已经走弱。

*   #### **次要条件 (至少满足两个):**
    1.  **市场结构破坏 (Price Action)**:
        *   **定义**: 在周线图上，当前周的最低价 (`Lower Low`) 跌破了前一周的最低价。
        *   **意义**: 破坏了牛市“高点不断抬高，低点也不断抬高”的上升结构，是趋势反转的纯粹价格行为信号。
    2.  **MVRV Z-Score 高位回落 (On-Chain Value)**:
        *   **定义**: MVRV Z-Score值**大于5.0**（进入历史顶部区域），并且当前值**小于**前一周的值。
        *   **意义**: 表明市场在被严重高估的区域开始降温，长期持有者获利了结的压力增大。
    3.  **aSOPR 跌破1 (On-Chain Profitability)**:
        *   **定义**: 调整后的SOPR（花费输出利润率）的周线平均值**小于1**。
        *   **意义**: 标志着市场参与者总体上正在“亏损卖出”。这是市场情绪由贪婪转向恐慌的关键转折点。
    4.  **周线RSI 高位回落 (Momentum)**:
        *   **定义**: 周线RSI（14周期）在过去4周内曾**高于70**（超买区），并且当前值**小于**前一周的值。
        *   **意义**: 表明市场的上涨动能正在衰竭。

---

### **4. “熊转牛”信号仪表盘 (Bear-to-Bull Dashboard)**

当以下**主条件**和**至少两个次要条件**同时满足时，触发“战略总攻”警报。

*   #### **主条件 (必须满足):**
    *   **20周EMA站稳**: 价格的**周线收盘价**，已**连续三周**高于其20周EMA。这确认了市场已经摆脱熊市压制，建立了新的上升趋势。

*   #### **次要条件 (至少满足两个):**
    1.  **市场结构逆转 (Price Action)**:
        *   **定义**: 在周线图上，当前周的最高价 (`Higher High`) 突破了前一周的最高价。
        *   **意义**: 扭转了熊市“高点不断降低，低点也不断降低”的下降结构。
    2.  **MVRV Z-Score 脱离底部 (On-Chain Value)**:
        *   **定义**: MVRV Z-Score值**大于0.5**并且当前值**大于**前一周的值。
        *   **意义**: 表明市场估值已脱离深度低估的“投降区”，开始进入复苏阶段。
    3.  **aSOPR 站稳1以上 (On-Chain Profitability)**:
        *   **定义**: aSOPR的周线平均值**持续大于1**。
        *   **意义**: 标志着市场恢复了信心，参与者普遍处于盈利状态并倾向于持有。
    4.  **周线RSI 摆脱超卖 (Momentum)**:
        *   **定义**: 周线RSI在过去8周内曾**低于30**（超卖区），并且当前值**大于**前一周的值。
        *   **意义**: 表明市场的下跌动能已经耗尽，买方力量开始重新占据主导。

---

### **5. 程序设置指南**

1.  **填写 `config.py`**: 这是运行程序的前提。请务必填写您的Glassnode API密钥和Telegram机器人信息。
2.  **安装依赖库**: 在终端运行 `pip install pandas pandas-ta requests schedule`。
3.  **运行程序**: 在终端进入`src`目录，然后运行 `python market_signal_monitor.py`。
